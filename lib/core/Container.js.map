{"version":3,"file":"Container.js","names":["Container","context","properties","key","callback","push","props","find","ctx","instance","container"],"sources":["../../src/core/Container.ts"],"sourcesContent":["/**\n * Dependency injection container\n * @author Francisco Ruiz\n */\nclass Container {\n  static container: Container;\n  private context: Context[];\n  private properties: object;\n\n  /**\n   * Private constructor to be only accessible within the class declaration\n   * @private\n   */\n  private constructor() {\n    this.context = [];\n    this.properties = {};\n  }\n\n  /**\n   * Gets always the same instance of the container. (Singleton pattern)\n   * @return Container\n   */\n  static getContainer(): Container {\n    if (!Container.container) {\n      Container.container = new Container();\n    }\n    return Container.container;\n  }\n\n  /**\n   * Add a new service or function to context\n   * @param key Unique key for the new service or function\n   * @param callback Callback function with dependency injection logic\n   */\n  public add(key: string, callback: Callback): Container {\n    this.context.push({\n      key,\n      callback,\n    });\n    return this;\n  }\n\n  /**\n   * Add an object configuration to container properties\n   * @param props Configuration properties object\n   * @return Container\n   */\n  public addProps(props: object): Container {\n    this.properties = {\n      ...this.properties,\n      ...props,\n    };\n    return this;\n  }\n\n  /**\n   * Find a context\n   * @param key Unique key of the service or function\n   * @private\n   * @return Context | undefined\n   */\n  private find(key: string): Context | undefined {\n    return this.context.find((ctx: Context) => ctx.key == key);\n  }\n\n  /**\n   * Gets always the same instance for a concrete context\n   * @param key Unique key of the service or function\n   * @return any\n   */\n  public get(key: string): any {\n    const ctx = this.find(key);\n    if (ctx) {\n      if (!ctx.instance) {\n        ctx.instance = ctx.callback({ container: this, props: this.properties });\n      }\n      return ctx.instance;\n    }\n    return null;\n  }\n\n  /**\n   * Gets always a new instance for a concrete context\n   * @param key Unique key of the service or function\n   * @return any\n   */\n  public getFactory(key: string): any {\n    const ctx = this.find(key);\n    return ctx\n      ? ctx.callback({ container: this, props: this.properties })\n      : null;\n  }\n\n  /**\n   * Gets the configuration properties object\n   * @return object\n   */\n  public getProps(): object {\n    return this.properties;\n  }\n}\n\n/**\n * Context definition\n */\nexport interface Context {\n  /**\n   * Unique key of the service or function\n   */\n  key: string;\n\n  /**\n   * Callback function with dependency injection logic\n   */\n  callback: Callback;\n\n  /**\n   * Instance of callback function\n   */\n  instance?: any;\n}\n\n/**\n * Properties definition\n */\nexport type Props = {\n  container: Container;\n  props: object | any;\n}\n\n/**\n * Callback definition\n */\nexport type Callback = (p: Props) => any;\n\nexport default Container;\n"],"mappings":"2vCAIMA,U,YASJ,YAAsB,yBACpB,KAAKC,OAAL,CAAe,EADK,CAEpB,KAAKC,UAAL,CAAkB,EACnB,C,wCAkBD,aAAWC,CAAX,CAAwBC,CAAxB,CAAuD,CAKrD,MAJA,MAAKH,OAAL,CAAaI,IAAb,CAAkB,CAChBF,GAAG,CAAHA,CADgB,CAEhBC,QAAQ,CAARA,CAFgB,CAAlB,CAIA,CAAO,IACR,C,wBAOD,kBAAgBE,CAAhB,CAA0C,CAKxC,MAJA,MAAKJ,UAAL,gCACK,KAAKA,UADV,EAEKI,CAFL,CAIA,CAAO,IACR,C,oBAQD,cAAaH,CAAb,CAA+C,CAC7C,MAAO,MAAKF,OAAL,CAAaM,IAAb,CAAkB,SAACC,CAAD,QAAkBA,EAAG,CAACL,GAAJ,EAAWA,CAA7B,CAAlB,CACR,C,mBAOD,aAAWA,CAAX,CAA6B,CAC3B,GAAMK,EAAG,CAAG,KAAKD,IAAL,CAAUJ,CAAV,CAAZ,CAD2B,MAEvBK,EAFuB,EAGpBA,CAAG,CAACC,QAHgB,GAIvBD,CAAG,CAACC,QAAJ,CAAeD,CAAG,CAACJ,QAAJ,CAAa,CAAEM,SAAS,CAAE,IAAb,CAAmBJ,KAAK,CAAE,KAAKJ,UAA/B,CAAb,CAJQ,EAMlBM,CAAG,CAACC,QANc,EAQpB,IACR,C,0BAOD,oBAAkBN,CAAlB,CAAoC,CAClC,GAAMK,EAAG,CAAG,KAAKD,IAAL,CAAUJ,CAAV,CAAZ,CACA,MAAOK,EAAG,CACNA,CAAG,CAACJ,QAAJ,CAAa,CAAEM,SAAS,CAAE,IAAb,CAAmBJ,KAAK,CAAE,KAAKJ,UAA/B,CAAb,CADM,CAEN,IACL,C,wBAMD,mBAA0B,CACxB,MAAO,MAAKA,UACb,C,8BA7ED,uBAAiC,CAI/B,MAHKF,EAAS,CAACU,SAGf,GAFEV,CAAS,CAACU,SAAV,CAAsB,GAAIV,EAE5B,EAAOA,CAAS,CAACU,SAClB,C,kBA4GYV,S"}